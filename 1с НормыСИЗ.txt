&НаСервере
Функция ПроверитьСотрудника(Сотрудник)
	Если Сотрудник = Справочники.Сотрудники.ПустаяСсылка() Тогда
		Сообщить("Выберите сотрудника");
		Возврат ИСТИНА;
	Иначе 
		ВывестиНаФормуНаСервере();
		Возврат ЛОЖЬ;
		
	КонецЕсли;	
	КонецФункции

&НаСервере
Процедура ВывестиНаФормуНаСервере()
	ОтчетОбъект = РеквизитФормыВЗначение("Отчет");
	Макет    = ОтчетОбъект.ПолучитьМакет("Макет");
	Область = Макет.Получитьобласть("Шапка");
	Область2 = Макет.Получитьобласть("Строка");
	ТабличныйДокумент.ОриентацияСтраницы = ОриентацияСтраницы.Ландшафт;
	ТабличныйДокумент.Автомасштаб=Истина; 

	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
		|	уатПартииТоваровНаСкладахОстатки.Склад.ФизическоеЛицо.ФИО КАК ФИО,
		|	уатПартииТоваровНаСкладахОстатки.Склад.ФизическоеЛицо.Пол КАК ПОЛ,
		|	ПараметрыСотрудника.РазмерОдежды,
		|	ПараметрыСотрудника.Рост,
		|	ПараметрыСотрудника.РазмерОбуви,
		|	ПараметрыСотрудника.РазмерШапки,
		|	ТекущиеКадровыеДанныеСотрудников.ТекущаяДолжность,
		|	уатПартииТоваровНаСкладахОстатки.КоличествоОстаток,
		|	уатПартииТоваровНаСкладахОстатки.Номенклатура.Наименование КАК Номенклатура,
		|	ТекущиеКадровыеДанныеСотрудников.ДатаПриема КАК ДатаПоступления,
		|	ТекущиеКадровыеДанныеСотрудников.Сотрудник.Код КАК ТабельныйНомер,
		|	ТекущиеКадровыеДанныеСотрудников.ТекущееПодразделение КАК СтруктурноеПодразделение
		|ИЗ
		|	РегистрНакопления.уатПартииТоваровНаСкладах.Остатки КАК уатПартииТоваровНаСкладахОстатки
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ТекущиеКадровыеДанныеСотрудников КАК ТекущиеКадровыеДанныеСотрудников
		|		ПО уатПартииТоваровНаСкладахОстатки.Склад = ТекущиеКадровыеДанныеСотрудников.Сотрудник
		|		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.ПараметрыСотрудника КАК ПараметрыСотрудника
		|		ПО уатПартииТоваровНаСкладахОстатки.Склад = ПараметрыСотрудника.Сотрудник
		|ГДЕ
		|	уатПартииТоваровНаСкладахОстатки.Склад = &СОТР";
	
	Запрос.УстановитьПараметр("СОТР", Сотрудник);

	РезультатЗапроса = Запрос.Выполнить();
	
	Сообщение = Новый СообщениеПользователю;
	//Если РезультатЗапроса.Пустой() Тогда
	//	Сообщение.Текст = "Записей по условию не найдено";
	//	Сообщение.Сообщить(); 
	//КонецЕсли;
	//
	Выборка = РезультатЗапроса.Выбрать();

	Пока Выборка.Следующий() Цикл

	Область.Параметры.Заполнить(Выборка);
	
	КонецЦикла;
	Область.Параметры.ДатаПоступления = Формат(Область.Параметры.ДатаПоступления, "ДФ=dd.MM.yyyy");

	 ТабличныйДокумент.Вывести(Область);	

	 Запрос2 = Новый Запрос;
	Запрос2.Текст = 
	 "ВЫБРАТЬ
	 |	НормыСИЗ.ПунктНорм КАК ПунктТиповыхНорм,
	 |	НормыСИЗ.КоличествоНаПериод КАК КолвоПер,
	 |	НормыСИЗ.Номенклатура.ЕдиницаИзмерения КАК ЕдиницаИзмерения,
	 |	НормыСИЗ.Наименование КАК СизИмя,
	 |	НормыСИЗ.ПунктНорм
	 |ИЗ
	 |	РегистрСведений.НормыСИЗ КАК НормыСИЗ
	 |ГДЕ
	 |	НормыСИЗ.Должность.Наименование ПОДОБНО &ТекущаяДолжность
	 |
	 |СГРУППИРОВАТЬ ПО
	 |	НормыСИЗ.ПунктНорм,
	 |	НормыСИЗ.Номенклатура.ЕдиницаИзмерения,
	 |	НормыСИЗ.Наименование,
	 |	НормыСИЗ.ПунктНорм,
	 |	НормыСИЗ.КоличествоНаПериод";

	 СтрокаДолжность = Область.Параметры.ТекущаяДолжность.Наименование;
	 
	 Если СтрНайти(СтрокаДолжность, "/") > 0 Тогда
		 СтрокаДолжность = Лев(СтрокаДолжность, СтрНайти(СтрокаДолжность, "/") - 1);
	КонецЕсли;
	 
	 Запрос2.УстановитьПараметр("ТекущаяДолжность", СтрокаДолжность);
	            
	РезультатЗапроса2 = Запрос2.Выполнить();
	
	Сообщение = Новый СообщениеПользователю;
	Если РезультатЗапроса2.Пустой() Тогда
		Сообщить("Записей для формирования списка перечня СИЗ не найдено для этой должности"); 
	КонецЕсли;
	
	Выборка2 = РезультатЗапроса2.Выбрать();

	Пока Выборка2.Следующий() Цикл

		Область2.Параметры.Заполнить(Выборка2);
		ТабличныйДокумент.Вывести(Область2);
	
	КонецЦикла;

	Область3 = Макет.Получитьобласть("Подвал");
	ТабличныйДокумент.Вывести(Область3);
	 ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();
	 
	 
	 Область4 = Макет.Получитьобласть("Шапка2");
	  ТабличныйДокумент.Вывести(Область4);
	Область5 = Макет.Получитьобласть("Строка2");
	

	Запрос3 = Новый Запрос;
	Запрос3.Текст = 
	 "ВЫБРАТЬ
	 |	уатПартииТоваровНаСкладах.Склад,
	 |	уатПартииТоваровНаСкладах.Номенклатура КАК Номенклатура,
	 |	ВЫБОР
	 |		КОГДА уатПартииТоваровНаСкладах.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	 |			ТОГДА уатПартииТоваровНаСкладах.Количество
	 |		ИНАЧЕ 0
	 |	КОНЕЦ КАК КоличествоПриход,
	 |	ВЫБОР
	 |		КОГДА уатПартииТоваровНаСкладах.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	 |			ТОГДА уатПартииТоваровНаСкладах.Период
	 |		ИНАЧЕ 0
	 |	КОНЕЦ КАК ДатаПриход,
	 |	ВЫБОР
	 |		КОГДА уатПартииТоваровНаСкладах.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	 |			ТОГДА уатПартииТоваровНаСкладах.Количество
	 |		ИНАЧЕ 0
	 |	КОНЕЦ КАК КоличествоРасход,
	 |	ВЫБОР
	 |		КОГДА уатПартииТоваровНаСкладах.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	 |			ТОГДА уатПартииТоваровНаСкладах.Период
	 |		ИНАЧЕ 0
	 |	КОНЕЦ КАК ДатаРасход,
	 |	уатПартииТоваровНаСкладах.Период КАК Период,
	 |	ВЫБОР
	 |		КОГДА уатПартииТоваровНаСкладах.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Приход)
	 |			ТОГДА уатПартииТоваровНаСкладах.Регистратор.Номер
	 |		ИНАЧЕ 0
	 |	КОНЕЦ КАК НомерПриход,
	 |	ВЫБОР
	 |		КОГДА уатПартииТоваровНаСкладах.ВидДвижения = ЗНАЧЕНИЕ(ВидДвиженияНакопления.Расход)
	 |			ТОГДА уатПартииТоваровНаСкладах.Регистратор.Номер
	 |		ИНАЧЕ 0
	 |	КОНЕЦ КАК НомерРасход
	 |ИЗ
	 |	РегистрНакопления.уатПартииТоваровНаСкладах КАК уатПартииТоваровНаСкладах
	 |ГДЕ
	 |	уатПартииТоваровНаСкладах.Склад = &СОТР
	 |	И уатПартииТоваровНаСкладах.Номенклатура.Родитель.Наименование = ""10.10 Спецодежда""
	 |
	 |УПОРЯДОЧИТЬ ПО
	 |	Период";

	 Запрос3.УстановитьПараметр("СОТР", Сотрудник);

	РезультатЗапроса3 = Запрос3.Выполнить();
	
	Сообщение3 = Новый СообщениеПользователю;
	Если РезультатЗапроса3.Пустой() Тогда
		Сообщение3.Текст = "Записей по условию не найдено";
		Сообщение3.Сообщить(); 
	КонецЕсли;
	
	Выборка3 = РезультатЗапроса3.Выбрать();
	
	Пока Выборка3.Следующий() Цикл     

				Пока Выборка3.Следующий() Цикл     
				Область5.Параметры.Заполнить(Выборка3);
				Область5.Параметры.ДатаПриход = Формат(Область5.Параметры.ДатаПриход, "ДФ=dd.MM.yyyy");
				Область5.Параметры.ДатаРасход= Формат(Область5.Параметры.ДатаРасход, "ДФ=dd.MM.yyyy");
				ТабличныйДокумент.Вывести(Область5);
				КонецЦикла;

	КонецЦикла;
		 ТабличныйДокумент.ВывестиГоризонтальныйРазделительСтраниц();

	  
	 
КонецПроцедуры	


&НаКлиенте
Процедура ВывестиНаФорму(Команда)
СЧЕТЧИК = 1;
Флаг = Истина;	
Если СЧЕТЧИК = 1 и Флаг = Истина Тогда 
	ПроверитьСотрудника(Сотрудник);
	Флаг = Ложь;
КонецЕсли;
КонецПроцедуры
